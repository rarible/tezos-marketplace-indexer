datasources:
  tzkt:
    kind: tzkt
    url: ${TZKT_URL:-http://tezos-tzkt.dev.rarible.int}

contracts:
  rarible_exchange:
    address: KT198cr9bKZDGVtgj7P4DazAjq38r74hFSVu
    typename: rarible_exchange
  rarible_exchange_legacy:
    address: KT18isH58SBp7UaRWB652UwLMPxCe1bsjMMe
    typename: rarible_exchange_legacy
  rarible_bids:
    address: KT1DJxerfM2nPYYsVNBxaevppwhkCGwZzsGT
    typename: rarible_bids
  objkt_v1:
    address: KT1Qa7sQdZrsuPMA7NFg5hMF9iadtoYSF8m9
    typename: objkt_marketplace
  objkt_v2:
    address: KT1LXKe92pjd8RJecjFS14ZRdmHPVec3twAD
    typename: objkt_marketplace_v2
  hen:
    address: KT1MoWbKvxhsuckLUnQUPjrnGRugiret3pSQ
    typename: hen_marketplace
  teia_v1:
    address: KT1SMn9NzXNvdMvtaK8gE5GHgYj8ZxCuSyWN
    typename: teia_v1
  versum_v1:
    address: KT1FQQttioJYMHYzJo97A2cxfdAqnUHoVjiG
    typename: versum_v1

indexes:
  rarible_exchange_actions:
    kind: operation
    datasource: tzkt
    contracts:
      - rarible_exchange
    handlers:
      - callback: rarible_order_list
        pattern:
          - destination: rarible_exchange
            entrypoint: sell
      - callback: rarible_order_cancel_list
        pattern:
          - destination: rarible_exchange
            entrypoint: cancel_sale
      - callback: rarible_order_match
        pattern:
          - destination: rarible_exchange
            entrypoint: buy

  rarible_exchange_legacy_actions:
    kind: operation
    datasource: tzkt
    contracts:
      - rarible_exchange_legacy
    handlers:
      - callback: rarible_match_orders_legacy
        pattern:
          - destination: rarible_exchange_legacy
            entrypoint: match_orders

  rarible_bids_actions:
    kind: operation
    datasource: tzkt
    contracts:
      - rarible_bids
    handlers:
      - callback: rarible_put_bid
        pattern:
          - destination: rarible_bids
            entrypoint: put_bid
      - callback: rarible_put_floor_bid
        pattern:
          - destination: rarible_bids
            entrypoint: put_floor_bid
      - callback: rarible_accept_bid
        pattern:
          - destination: rarible_bids
            entrypoint: accept_bid
      - callback: rarible_accept_floor_bid
        pattern:
          - destination: rarible_bids
            entrypoint: accept_floor_bid
      - callback: rarible_cancel_bid
        pattern:
          - destination: rarible_bids
            entrypoint: cancel_bid
      - callback: rarible_cancel_floor_bid
        pattern:
          - destination: rarible_bids
            entrypoint: cancel_floor_bid

  objkt_v1_actions:
    kind: operation
    datasource: tzkt
    contracts:
      - objkt_v1
    handlers:
      - callback: objkt_order_list
        pattern:
          - destination: objkt_v1
            entrypoint: ask
      - callback: objkt_order_cancel_list
        pattern:
          - destination: objkt_v1
            entrypoint: retract_ask
      - callback: objkt_order_match
        pattern:
          - destination: objkt_v1
            entrypoint: fulfill_ask

  objkt_v2_actions:
    kind: operation
    datasource: tzkt
    contracts:
      - objkt_v2
    handlers:
      - callback: objkt_v2_order_list
        pattern:
          - destination: objkt_v2
            entrypoint: ask

      - callback: objkt_v2_order_cancel_list
        pattern:
          - destination: objkt_v2
            entrypoint: retract_ask

      - callback: objkt_v2_order_match
        pattern:
          - destination: objkt_v2
            entrypoint: fulfill_ask

  hen_actions:
    kind: operation
    datasource: tzkt
    contracts:
      - hen
    handlers:
      - callback: hen_order_list
        pattern:
          - destination: hen
            entrypoint: swap
      - callback: hen_order_cancel_list
        pattern:
          - destination: hen
            entrypoint: cancel_swap
      - callback: hen_order_match
        pattern:
          - destination: hen
            entrypoint: collect

  teia_v1_actions:
    kind: operation
    datasource: tzkt
    contracts:
      - teia_v1
    handlers:
      - callback: teia_v1_list_order
        pattern:
          - destination: teia_v1
            entrypoint: swap
      - callback: teia_v1_cancel_order
        pattern:
          - destination: teia_v1
            entrypoint: cancel_swap
      - callback: teia_v1_match_order
        pattern:
          - destination: teia_v1
            entrypoint: collect

  versum:
    kind: operation
    datasource: tzkt
    contracts:
      - versum_v1
    handlers:
      - callback: versum_v1_order_list
        pattern:
          - type: transaction
            destination: versum_v1
            entrypoint: create_swap
      - callback: versum_v1_order_cancel
        pattern:
          - type: transaction
            destination: versum_v1
            entrypoint: cancel_swap
      - callback: versum_v1_order_match
        pattern:
          - type: transaction
            destination: versum_v1
            entrypoint: collect_swap

  token_transfers:
    kind: token_transfer
    datasource: tzkt
    handlers:
      - callback: on_transfer

  origination:
    kind: head
    datasource: tzkt
    handlers:
      - callback: on_head

hooks:
  process_collection_events:
    callback: process_collection_events
    atomic: False
    args:
      force_reindex: bool
      head: int

advanced:
  rollback_depth: 2
  reindex:
    manual: wipe
    migration: exception
    rollback: exception
    config_modified: ignore
    schema_modified: ignore